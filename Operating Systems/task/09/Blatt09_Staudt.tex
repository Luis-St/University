\documentclass[
	fontsize=12pt,          % default font size 12pt
	paper=a4,               % DIN A4 page format
	numbers=noenddot,       % remove dots behind chapter numbers (e.g. 1.5 not 1.5.)
	listof=totoc,           % add list of figures, tables, etc. to ToC
	listof=entryprefix,     % add entry name to figures, tables, etc.
	listof=nochaptergap,    % no chapter gap for figures, tables, etc.
	bibliography=totoc,     % add bibliography to ToC but without a chapter number
	parskip=half            % half line spacing between paragraphs
	openany                 % chapters can start on any page
]{scrbook}

\include{../../for_latex/preamble}

% ############################################################################
% WIE MACH ICH DAS HIER?
% 
% 1. Schreibe im "titlepage" Abschnitt den Titel in das element mit "\fontsize{22}{22}"
% 2. Aus obsidian raus kopieren mit "Copy to LaTeX"
% 3. Zwischen "CONTENT STARTS HERE" und "CONTENT ENDS HERE" den Inhalt einfügen
% 4. Sections anpassen. Damit man ne gescheite Chapter > Section > Subsection Struktur hat
% 5. Leere Seite nach Titelseite am Anfang mit {\let\cleardoublepage\relax \chapter{Erstes Kapitel}} verhindern
%
% TABELLEN
% Müssen extra gemacht werden, da obsidian das nicht unterstützt
% Kann ich nur empfehlen: https://tableconvert.com/markdown-to-latex
%
% BILDER
% Muss man vermutlich auch extra machen, hab ich aber noch nicht probiert
% ############################################################################

\usepackage{amssymb}

\title{Betriebssysteme Aufgabenblatt 9 - Lösungen}
\author{Luis Staudt}
\date{}

\begin{document}

\begin{titlepage}
	\pagestyle{empty}
	
	% HFU Logo
	\begin{flushright}
		\begin{figure}[ht]
			\flushright
			\includegraphics[height=2cm]{../../for_latex/hfu}
		\end{figure}
	\end{flushright}
	
	\begin{center}
		\vspace{3cm}
		
		{\fontsize{22}{22} \selectfont \textbf{Blatt 9}}\\[5mm]
		{\fontsize{18}{18} \selectfont Betriebssysteme}
		
		\vspace{12cm}
		
		{\fontsize{14}{14} \selectfont Luis Staudt}
	\end{center}
\end{titlepage}

% ############################################################################
% CONTENT STARTS HERE
% ############################################################################

\section*{Aufgabe 1: Körner essen}
\subsection*{Fragen zur Methode \texttt{bearbeiteKachel}}

\paragraph*{Frage 1:}
Mit welcher Methode von \texttt{Territorium} kann man die Zahl der Körner um eins verringern?

\paragraph*{Antwort:}
Mit der Methode \lstinline{dekrementAndGet()} des \texttt{AtomicInteger} Objekts.
Diese Methode ermöglicht es mehreren Threads gleichzeitig, den Wert atomisch um eins zu erniedrigen.

\vspace{0.5cm}

\paragraph*{Frage 2:}
Studieren Sie den Code der Methode.
Warum müsste man diese Methode \texttt{synchronized} machen und warum kann man sich das trotzdem sparen?

\paragraph*{Antwort:}
\begin{itemize}
	\item \textbf{Warum synchronized nötig wäre:} Mehrere Threads greifen gleichzeitig auf dasselbe \lstinline{zahlKoerner[i][j]} Attribut zu, was zu Race Conditions führen kann (Register Problem aus der Vorlesung).
	\item \textbf{Warum es trotzdem nicht nötig ist:} \texttt{AtomicInteger} ist bereits thread-safe und bietet atomare Operationen ohne explizite Synchronisation.
\end{itemize}

\vspace{0.5cm}

\paragraph*{Frage 3:}
Wie kann man die \texttt{CyclicBarrier} verwenden, damit jeder Esser die ursprüngliche Zahl der Körner sieht?

\paragraph{Antwort:}
\begin{enumerate}
	\item Alle Threads lesen zuerst die ursprüngliche Körnerzahl
	\item Dann warten alle Threads an der \lstinline{CyclicBarrier} mit \lstinline{await()}
	\item Erst wenn alle 3 Threads die ursprüngliche Zahl gelesen haben, werden sie gleichzeitig freigegeben
	\item Danach können alle gleichzeitig die Körnerzahl reduzieren
\end{enumerate}

\subsection*{Fragen zur Methode \texttt{main}}

\paragraph*{Frage:}
Warum muss man den Threadpool in unserer Aufgabe mit genau drei Threads bestücken?

\paragraph*{Antwort:}
Die \texttt{CyclicBarrier} wird im Konstruktor auf eine feste Anzahl von Threads eingestellt (hier: 3).
Das \lstinline{await()} blockiert solange, bis genau diese Anzahl erreicht ist:

\begin{itemize}
	\item Bei weniger als 3 Threads: Die Threads bleiben in \lstinline{await()} hängen
	\item Bei mehr als 3 Threads: Überzählige Threads werden nicht synchronisiert
\end{itemize}

\section*{Aufgabe 2: Ressourcen Manager}
\subsection*{Banker's Algorithm - Testfälle}

\paragraph*{Ausgangssituation:}
\begin{align}
	\text{Thread A:} &\quad \text{Max: 9} \\
	\text{Thread B:} &\quad \text{Max: 4, Aktuell: 2} \\
	\text{Thread C:} &\quad \text{Max: 7, Aktuell: 2} \\
	\text{Gesamte Betriebsmittel:} &\quad 10
\end{align}

\paragraph*{Testfall 1: A hat aktuelle Belegung 3 (SICHER)}
\begin{table}[h]
	\centering
	\begin{tabular}{|c|c|c|c|}
		\hline
		Thread & Aktuell & Maximum & Restforderung \\
		\hline
		A & 3 & 9 & 6 \\
		B & 2 & 4 & 2 \\
		C & 2 & 7 & 5 \\
		\hline
	\end{tabular}
\end{table}

Freie Betriebsmittel: $10 - 3 - 2 - 2 = 3$
\textbf{Sichere Ausführungsreihenfolge:}
\begin{enumerate}
	\item B kann fertig werden (Restforderung 2 $\leq$ 3 frei)
	\item Nach B: $3 + 2 = 5$ freie Betriebsmittel
	\item C kann fertig werden (Restforderung 5 $\leq$ 5 frei)
	\item Nach C: $5 + 2 = 7$ freie Betriebsmittel
	\item A kann fertig werden (Restforderung 6 $\leq$ 7 frei)
\end{enumerate}

\paragraph*{Testfall 2: A hat aktuelle Belegung 4 (UNSICHER)}
\begin{table}[h]
	\centering
	\begin{tabular}{|c|c|c|c|}
		\hline
		Thread & Aktuell & Maximum & Restforderung \\
		\hline
		A & 4 & 9 & 5 \\
		B & 2 & 4 & 2 \\
		C & 2 & 7 & 5 \\
		\hline
	\end{tabular}
\end{table}

Freie Betriebsmittel: $10 - 4 - 2 - 2 = 2$

\textbf{Deadlock-Szenario:}
\begin{itemize}
	\item Nur B kann fertig werden (Restforderung 2 $\leq$ 2 frei)
	\item Nach B: $2 + 2 = 4$ freie Betriebsmittel
	\item Weder A noch C können fertig werden (beide brauchen 5)
	\item $\Rightarrow$ Potentieller Deadlock!
\end{itemize}

% ############################################################################
% CONTENT ENDS HERE
% ############################################################################

\end{document}
